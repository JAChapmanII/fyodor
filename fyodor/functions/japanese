#!/bin/zsh
#&` engjap->engjap
#&` englishtojapanese->engjap

japanese_dir="japanese"
[ -d "$japanese_dir" ] || mkdir -p $japanese_dir

function engjap() #
{
	if [ -z "$1" ]
	then
		return
	fi
	pushd $japanese_dir
	if [ ! -f "$1" ]
	then
		wget -q -U Mozilla -O "${1}.tmp" "http://jisho.org/words?jap=&nolimit=1&page=&dict=edict&eng=${1}"
		sed '1,/<div id="result">/d' "${1}.tmp" |
		egrep '(class="kanji"|kana_column|meanings_column)' |
		sed -e 's/[ \t]\+/ /g' -e 's/<[^>]*>//g' > "$1"
		rm "${1}.tmp"
	fi

	total="$(echo "$AMOUNT -1" | bc)"
	AMOUNT="1"
	for i in {0..$total}
	do
		headnum="$(echo "3 + ( $i * 3 )" | bc)"
		japtext="$(head -n$headnum "$1" | tail -n3 | head -n2)"
		engtext="$(head -n$headnum "$1" | tail -n1)"
		if [ ! -z "$engtext" ]
		then
			convert -background  white -fill black -font Kochi-Gothic-Regular \
			-pointsize 18 label:"${japtext}" "${1}-${i}.jpg"

			mv "${1}-${i}.jpg" ${attachments}
			MMS "${engtext}"
		fi
		sleep 1
	done

	popd
}

