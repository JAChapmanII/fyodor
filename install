#!/bin/zsh

if [ "`pwd`" != "/home/jac/src/multi/fyodor" ]
then
	echo "Please make sure you're in the right directory, \
or this could get sticky."
	exit 1
fi

dt="`date +'%y.%m.%d.%H.%M.%S.%N'`"
archive="home_fyodor.bak.$dt.tar.gz"
set -A dirs \
	"Mail"

echo "The date is currently: $dt"
echo "Commiting the current repo so that we have a backup"
git commit -a -m "Pushing current to live on $dt"
echo "Tar'ing up /home/fyodor for safe keeping in $archive"
sudo tar -cf "$archive" /home/fyodor
mkdir -p fyodor_tmp
for dir in $dirs
do
	echo "Moving $dir to a temporary safe location"
	mv /home/fyodor/$dir fyodor_tmp
done
echo "Removing everyithng that was in /home/fyodor"
sudo rm -R /home/fyodor/
echo "Pushing fyodor to /home"
sudo cp -R fyodor /home
for dir in $dirs
do
	echo "Moving $dir back into place"
	mv fyodor_tmp/$dir /home/fyodor
done
rmdir fyodor_tmp
echo "Changing the ownership on /home/fyodor so Fyodor can read/write them"
sudo chown -R fyodor:users /home/fyodor
echo "New version installed!"
